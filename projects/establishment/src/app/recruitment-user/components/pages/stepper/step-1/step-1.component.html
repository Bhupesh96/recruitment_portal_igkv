<form [formGroup]="form" class="w-full font-['Source Sans Pro',sans-serif]">
  <div class="space-y-8 text-sm text-gray-700">
    <!-- Applicant Name Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
          />
        </svg>
        Applicant name
      </h6>
      <div class="grid md:grid-cols-4 gap-4">
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Salutation (English)<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Salutation_E"
            [class.border-red-500]="
              form.get('Salutation_E')?.invalid &&
              form.get('Salutation_E')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
          >
            <option value="" disabled selected>Select Salutation</option>
            <option *ngFor="let sal of salutations" [value]="sal.salutation_id">
              {{ sal.salutation_name_e }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Salutation_E')?.invalid &&
              form.get('Salutation_E')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Salutation is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >First Name<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Applicant_First_Name_E"
            [class.border-red-500]="
              form.get('Applicant_First_Name_E')?.invalid &&
              form.get('Applicant_First_Name_E')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="First name"
          />
          <div
            *ngIf="
              form.get('Applicant_First_Name_E')?.invalid &&
              form.get('Applicant_First_Name_E')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            First name is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Middle Name</label
          >
          <input
            formControlName="Applicant_Middle_Name_E"
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Middle name"
          />
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Last Name<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Applicant_Last_Name_E"
            [class.border-red-500]="
              form.get('Applicant_Last_Name_E')?.invalid &&
              form.get('Applicant_Last_Name_E')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Last name"
          />
          <div
            *ngIf="
              form.get('Applicant_Last_Name_E')?.invalid &&
              form.get('Applicant_Last_Name_E')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Last name is required
          </div>
        </div>
      </div>

      <div class="grid md:grid-cols-4 gap-4 mt-4">
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Salutation (Hindi)<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Salutation_H"
            [class.border-red-500]="
              form.get('Salutation_H')?.invalid &&
              form.get('Salutation_H')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
          >
            <option value="" disabled selected>Salutation</option>
            <option *ngFor="let sal of salutations" [value]="sal.salutation_id">
              {{ sal.salutation_name_h }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Salutation_H')?.invalid &&
              form.get('Salutation_H')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Salutation is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >First Name (Hindi)<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Applicant_First_Name_H"
            [class.border-red-500]="
              form.get('Applicant_First_Name_H')?.invalid &&
              form.get('Applicant_First_Name_H')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="First name (Hindi)"
          />
          <div
            *ngIf="
              form.get('Applicant_First_Name_H')?.invalid &&
              form.get('Applicant_First_Name_H')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            First name is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Middle Name (Hindi)</label
          >
          <input
            formControlName="Applicant_Middle_Name_H"
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Middle name (Hindi)"
          />
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Last Name (Hindi)<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Applicant_Last_Name_H"
            [class.border-red-500]="
              form.get('Applicant_Last_Name_H')?.invalid &&
              form.get('Applicant_Last_Name_H')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Last name (Hindi)"
          />
          <div
            *ngIf="
              form.get('Applicant_Last_Name_H')?.invalid &&
              form.get('Applicant_Last_Name_H')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Last name is required
          </div>
        </div>
      </div>
    </div>

    <!-- Basic Details Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
          />
        </svg>
        Basic Details
      </h6>
      <div class="grid md:grid-cols-3 gap-4">
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Advertisement<span class="text-red-500">*</span></label
          >
          <select
            formControlName="a_rec_adv_main_id"
            [class.border-red-500]="
              form.get('a_rec_adv_main_id')?.invalid &&
              form.get('a_rec_adv_main_id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option
              *ngFor="let adv of advertisementList"
              [value]="adv.a_rec_adv_main_id"
            >
              {{ adv.advertisment_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('a_rec_adv_main_id')?.invalid &&
              form.get('a_rec_adv_main_id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Advertisement is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Post<span class="text-red-500">*</span></label
          >
          <select
            formControlName="post_code"
            [class.border-red-500]="
              form.get('post_code')?.invalid && form.get('post_code')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option *ngFor="let post of postList" [value]="post.post_code">
              {{ post.post_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('post_code')?.invalid && form.get('post_code')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Post is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Subject</label
          >
          <select
            formControlName="subject_id"
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select Subject</option>
            <option
              *ngFor="let subject of subjectList"
              [ngValue]="subject.subject_id"
            >
              {{ subject.Subject_Name_E }}
            </option>
          </select>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Gender<span class="text-red-500">*</span></label
          >
          <div class="flex gap-4">
            <label class="flex items-center">
              <input
                type="radio"
                value="Male"
                formControlName="Gender_Id"
                class="mr-1 text-blue-600 focus:ring-blue-600"
              />
              Male
            </label>
            <label class="flex items-center">
              <input
                type="radio"
                value="Female"
                formControlName="Gender_Id"
                class="mr-1 text-blue-600 focus:ring-blue-600"
              />
              Female
            </label>
            <label class="flex items-center">
              <input
                type="radio"
                value="Third Gender"
                formControlName="Gender_Id"
                class="mr-1 text-blue-600 focus:ring-blue-600"
              />
              Third Gender
            </label>
          </div>
          <div
            *ngIf="
              form.get('Gender_Id')?.invalid && form.get('Gender_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Gender is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Date of Birth<span class="text-red-500">*</span></label
          >
          <input
            type="date"
            formControlName="DOB"
            (change)="onDobChange($event)"
            [class.border-red-500]="
              form.get('DOB')?.invalid && form.get('DOB')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
          />
          <div
            *ngIf="form.get('DOB')?.invalid && form.get('DOB')?.touched"
            class="text-red-500 text-xs mt-1"
          >
            <span *ngIf="form.get('DOB')?.hasError('required')">
              Date of birth is required
            </span>
            <span *ngIf="form.get('DOB')?.hasError('invalidDobMax')">
              Date cannot be after
              {{ form.get('DOB')?.errors?.['invalidDobMax'].max }}.
            </span>
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Age</label
          >
          <input
            type="text"
            formControlName="age"
            readonly
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-gray-100 text-gray-500 cursor-not-allowed focus:outline-none focus:ring-0"
          />
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Father's name<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Applicant_Father_Name_E"
            [class.border-red-500]="
              form.get('Applicant_Father_Name_E')?.invalid &&
              form.get('Applicant_Father_Name_E')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Father's name"
          />
          <div
            *ngIf="
              form.get('Applicant_Father_Name_E')?.invalid &&
              form.get('Applicant_Father_Name_E')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Father's name is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Mother's name<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Applicant_Mother_Name_E"
            [class.border-red-500]="
              form.get('Applicant_Mother_Name_E')?.invalid &&
              form.get('Applicant_Mother_Name_E')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Mother's name"
          />
          <div
            *ngIf="
              form.get('Applicant_Mother_Name_E')?.invalid &&
              form.get('Applicant_Mother_Name_E')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Mother's name is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Religion<span class="text-red-500">*</span></label
          >
          <select
            formControlName="religion_code"
            [class.border-red-500]="
              form.get('religion_code')?.invalid &&
              form.get('religion_code')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select Religion</option>
            <option
              *ngFor="let religion of religionList"
              [value]="religion.religion_code"
            >
              {{ religion.religion_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('religion_code')?.invalid &&
              form.get('religion_code')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Religion is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Identification Mark 1<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Identification_Mark1"
            [class.border-red-500]="
              form.get('Identification_Mark1')?.invalid &&
              form.get('Identification_Mark1')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Identification Mark 1"
          />
          <div
            *ngIf="
              form.get('Identification_Mark1')?.invalid &&
              form.get('Identification_Mark1')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Identification mark is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Identification Mark 2<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Identification_Mark2"
            [class.border-red-500]="
              form.get('Identification_Mark2')?.invalid &&
              form.get('Identification_Mark2')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Identification Mark 2"
          />
          <div
            *ngIf="
              form.get('Identification_Mark2')?.invalid &&
              form.get('Identification_Mark2')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Identification mark is required
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Information Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        Additional Information
      </h6>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-6 text-sm">
        <ng-container *ngFor="let question of additionalQuestions">
          <div class="flex flex-col space-y-1">
            <div>
              <label class="block text-gray-600 text-sm font-medium">
                {{ question.question_label }}<span class="text-red-500">*</span>
              </label>
              <div class="flex items-center gap-4 flex-wrap pt-1">
                <label
                  *ngFor="let option of question.options"
                  class="flex items-center"
                >
                  <input
                    type="radio"
                    [name]="'question_' + question.question_id"
                    [value]="option.option_value"
                    [checked]="
                      form.get('question_' + question.question_id)?.value ===
                      option.option_value
                    "
                    (change)="
                      handleRadioChange(
                        'question_' + question.question_id,
                        option.option_value
                      )
                    "
                    class="mr-1 text-blue-600 focus:ring-blue-600"
                  />
                  {{ option.option_label }}
                </label>
              </div>
              <div
                *ngIf="
                  form.get('question_' + question.question_id)?.invalid &&
                  form.get('question_' + question.question_id)?.touched
                "
                class="text-red-500 text-xs mt-1"
              >
                This field is required
              </div>
            </div>

            <ng-container
              *ngIf="getSelectedOption(question)?.has_condition === 'Y'"
            >
              <div
                *ngFor="
                  let condition of getSelectedOption(question)?.conditions
                "
                class="flex flex-col space-y-1 pt-3 mt-2 ml-4 pl-4 border-l-2 border-gray-200"
              >
                <label class="block text-gray-500 text-sm font-semibold">
                  {{ condition.dependent_field_label }}
                  <span
                    *ngIf="condition.condition_required === 'Y'"
                    class="text-red-500"
                    >*</span
                  >
                </label>

                <ng-container [ngSwitch]="condition.condition_data_type">
                  <!-- DATE INPUT: Includes change event for marriage date validation -->
                  <input
                    *ngSwitchCase="'date'"
                    type="date"
                    [formControlName]="'condition_' + condition.condition_id"
                    (change)="
                      condition.condition_id === 1 &&
                        onMarriageDateChange($event)
                    "
                    class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
                  />

                  <!-- FILE INPUT: No changes here -->
                  <ng-container *ngSwitchCase="'file'">
                    <input
                      type="file"
                      (change)="
                        onConditionalFileSelected(
                          $event,
                          'condition_' + condition.condition_id,
                          condition.data_type_size
                        )
                      "
                      class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                    />
                    <div
                      *ngIf="
                        getAdditionalFilePath(
                          'condition_' + condition.condition_id
                        ) as filePath
                      "
                      class="mt-2 flex items-center gap-4"
                    >
                      <a
                        [href]="getFileUrl(filePath)"
                        target="_blank"
                        class="text-xs text-blue-600 hover:underline flex items-center"
                      >
                        <svg
                          class="h-4 w-4 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                          />
                        </svg>
                        View Uploaded File
                      </a>
                    </div>
                  </ng-container>

                  <!-- DEFAULT (TEXT) INPUT: No changes here -->
                  <input
                    *ngSwitchDefault
                    type="text"
                    [formControlName]="'condition_' + condition.condition_id"
                    class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
                  />
                </ng-container>

                <!-- VALIDATION MESSAGES: Updated to handle multiple error types -->
                <div
                  *ngIf="
                    form.get('condition_' + condition.condition_id)?.invalid &&
                    form.get('condition_' + condition.condition_id)?.touched
                  "
                  class="text-red-500 text-xs mt-1"
                >
                  <!-- Message for when the field is empty -->
                  <ng-container
                    *ngIf="
                      form
                        .get('condition_' + condition.condition_id)
                        ?.hasError('required')
                    "
                  >
                    {{ condition.dependent_field_label }} is required
                  </ng-container>

                  <!-- Message for when the marriage date is after the allowed maximum -->
                  <ng-container
                    *ngIf="
                      form
                        .get('condition_' + condition.condition_id)
                        ?.hasError('invalidMarriageDateMax')
                    "
                  >
                    Date cannot be after
                    {{
          form.get('condition_' + condition.condition_id)?.errors?.[
            'invalidMarriageDateMax'
          ].max

                    }}.
                  </ng-container>
                </div>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>
    </div>
    <!-- Permanent Address Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
        Permanent Address
      </h6>
      <div class="grid md:grid-cols-3 gap-4">
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Address<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Permanent_Address1"
            [class.border-red-500]="
              form.get('Permanent_Address1')?.invalid &&
              form.get('Permanent_Address1')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Address"
          />
          <div
            *ngIf="
              form.get('Permanent_Address1')?.invalid &&
              form.get('Permanent_Address1')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Address is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >City<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Permanent_City"
            [class.border-red-500]="
              form.get('Permanent_City')?.invalid &&
              form.get('Permanent_City')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="City"
          />
          <div
            *ngIf="
              form.get('Permanent_City')?.invalid &&
              form.get('Permanent_City')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            City is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Country<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Permanent_Country_Id"
            [class.border-red-500]="
              form.get('Permanent_Country_Id')?.invalid &&
              form.get('Permanent_Country_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled>Select Country</option>
            <option
              *ngFor="let country of countryList"
              [value]="country.country_id"
            >
              {{ country.country_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Permanent_Country_Id')?.invalid &&
              form.get('Permanent_Country_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Country is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >State<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Permanent_State_Id"
            [class.border-red-500]="
              form.get('Permanent_State_Id')?.invalid &&
              form.get('Permanent_State_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select State</option>
            <option *ngFor="let state of stateList" [value]="state.state_id">
              {{ state.name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Permanent_State_Id')?.invalid &&
              form.get('Permanent_State_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            State is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >District<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Permanent_District_Id"
            [class.border-red-500]="
              form.get('Permanent_District_Id')?.invalid &&
              form.get('Permanent_District_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select District</option>
            <option
              *ngFor="let district of districtList"
              [value]="district.district_id"
            >
              {{ district.district_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Permanent_District_Id')?.invalid &&
              form.get('Permanent_District_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            District is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Pincode<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Permanent_Pin_Code"
            [class.border-red-500]="
              form.get('Permanent_Pin_Code')?.invalid &&
              form.get('Permanent_Pin_Code')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Pincode"
          />
          <div
            *ngIf="
              form.get('Permanent_Pin_Code')?.invalid &&
              form.get('Permanent_Pin_Code')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Pincode is required
          </div>
        </div>
      </div>
      <div class="mt-4">
        <label class="flex items-center">
          <input
            type="checkbox"
            formControlName="presentSame"
            class="mr-2 text-blue-600 focus:ring-blue-600"
          />
          Present address is same as permanent
        </label>
      </div>

      <!-- Present Address Section -->
      <h6
        class="text-sm font-medium text-blue-600 flex items-center gap-2 mt-6"
      >
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
        Present Address
      </h6>
      <div class="grid md:grid-cols-3 gap-4">
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Address<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Current_Address1"
            [class.border-red-500]="
              form.get('Current_Address1')?.invalid &&
              form.get('Current_Address1')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Address"
          />
          <div
            *ngIf="
              form.get('Current_Address1')?.invalid &&
              form.get('Current_Address1')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Address is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >City<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Current_City"
            [class.border-red-500]="
              form.get('Current_City')?.invalid &&
              form.get('Current_City')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="City"
          />
          <div
            *ngIf="
              form.get('Current_City')?.invalid &&
              form.get('Current_City')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            City is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Country<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Current_Country_Id"
            [class.border-red-500]="
              form.get('Current_Country_Id')?.invalid &&
              form.get('Current_Country_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled>Select Country</option>
            <option
              *ngFor="let country of countryList"
              [value]="country.country_id"
            >
              {{ country.country_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Current_Country_Id')?.invalid &&
              form.get('Current_Country_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Country is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >State<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Current_State_Id"
            [class.border-red-500]="
              form.get('Current_State_Id')?.invalid &&
              form.get('Current_State_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select State</option>
            <option *ngFor="let state of stateList" [value]="state.state_id">
              {{ state.name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Current_State_Id')?.invalid &&
              form.get('Current_State_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            State is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >District<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Current_District_Id"
            [class.border-red-500]="
              form.get('Current_District_Id')?.invalid &&
              form.get('Current_District_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select District</option>
            <option
              *ngFor="let district of districtList"
              [value]="district.district_id"
            >
              {{ district.district_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Current_District_Id')?.invalid &&
              form.get('Current_District_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            District is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Pincode<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Current_Pin_Code"
            [class.border-red-500]="
              form.get('Current_Pin_Code')?.invalid &&
              form.get('Current_Pin_Code')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Pincode"
          />
          <div
            *ngIf="
              form.get('Current_Pin_Code')?.invalid &&
              form.get('Current_Pin_Code')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Pincode is required
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
          />
        </svg>
        Contact
      </h6>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Email Address<span class="text-red-500">*</span></label
          >
          <input
            type="email"
            formControlName="Email_Id"
            [class.border-red-500]="
              form.get('Email_Id')?.invalid && form.get('Email_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Email Address"
          />
          <div
            *ngIf="
              form.get('Email_Id')?.invalid && form.get('Email_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            <span *ngIf="form.get('Email_Id')?.errors?.['required']"
              >Email is required</span
            >
            <span *ngIf="form.get('Email_Id')?.errors?.['email']"
              >Please enter a valid email address</span
            >
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Mobile Number<span class="text-red-500">*</span></label
          >
          <input
            type="tel"
            formControlName="Mobile_No"
            [class.border-red-500]="
              form.get('Mobile_No')?.invalid && form.get('Mobile_No')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Mobile Number"
          />
          <div
            *ngIf="
              form.get('Mobile_No')?.invalid && form.get('Mobile_No')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Mobile number is required
          </div>
        </div>
      </div>
    </div>

    <!-- Place of Birth Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
        Place of Birth
      </h6>
      <div class="grid md:grid-cols-3 gap-4">
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Village / City / Block<span class="text-red-500">*</span></label
          >
          <input
            formControlName="Birth_Place"
            [class.border-red-500]="
              form.get('Birth_Place')?.invalid &&
              form.get('Birth_Place')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
            placeholder="Village / City / Block"
          />
          <div
            *ngIf="
              form.get('Birth_Place')?.invalid &&
              form.get('Birth_Place')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Birth place is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >Country<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Birth_Country_Id"
            [class.border-red-500]="
              form.get('Birth_Country_Id')?.invalid &&
              form.get('Birth_Country_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled>Select Country</option>
            <option
              *ngFor="let country of countryList"
              [value]="country.country_id"
            >
              {{ country.country_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Birth_Country_Id')?.invalid &&
              form.get('Birth_Country_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Country is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >State<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Birth_State_Id"
            [class.border-red-500]="
              form.get('Birth_State_Id')?.invalid &&
              form.get('Birth_State_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select State</option>
            <option *ngFor="let state of stateList" [value]="state.state_id">
              {{ state.name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Birth_State_Id')?.invalid &&
              form.get('Birth_State_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            State is required
          </div>
        </div>
        <div>
          <label class="block mb-1 text-gray-600 text-sm font-medium"
            >District<span class="text-red-500">*</span></label
          >
          <select
            formControlName="Birth_District_Id"
            [class.border-red-500]="
              form.get('Birth_District_Id')?.invalid &&
              form.get('Birth_District_Id')?.touched
            "
            class="w-full border border-gray-300 rounded-md px-3 py-2 bg-white"
          >
            <option value="" disabled selected>Select District</option>
            <option
              *ngFor="let district of districtList"
              [value]="district.district_id"
            >
              {{ district.district_name }}
            </option>
          </select>
          <div
            *ngIf="
              form.get('Birth_District_Id')?.invalid &&
              form.get('Birth_District_Id')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            District is required
          </div>
        </div>
      </div>
    </div>

    <!-- Photo & Signature Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 10l4.553 2.276A1 1 0 0120 13.118v2.764a1 1 0 01-.447.842L15 19M4 6h16M4 10h16M4 14h9"
          />
        </svg>
        Applicant Photo & Signature
      </h6>

      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700"
            >Upload Photo<span class="text-red-500">*</span></label
          >
          <input
            id="photoInput"
            type="file"
            (change)="onPhotoSelected($event)"
            accept="image/*"
            class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
          />
          <div
            *ngIf="form.get('photo')?.invalid && form.get('photo')?.touched"
            class="text-red-500 text-xs mt-1"
          >
            Photo is required
          </div>
          <div *ngIf="photoPreview" class="mt-2 flex items-center gap-4">
            <img
              [src]="photoPreview"
              alt="Photo Preview"
              class="w-24 h-24 object-cover border rounded shadow"
            />
            <button
              type="button"
              (click)="clearPhoto()"
              class="text-red-600 hover:underline text-sm"
            >
              Remove
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700"
            >Upload Signature<span class="text-red-500">*</span></label
          >
          <input
            id="signatureInput"
            type="file"
            (change)="onSignatureSelected($event)"
            accept="image/*"
            class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
          />
          <div
            *ngIf="
              form.get('signature')?.invalid && form.get('signature')?.touched
            "
            class="text-red-500 text-xs mt-1"
          >
            Signature is required
          </div>
          <div *ngIf="signaturePreview" class="mt-2 flex items-center gap-4">
            <img
              [src]="signaturePreview"
              alt="Signature Preview"
              class="w-40 h-16 object-contain border rounded shadow"
            />
            <button
              type="button"
              (click)="clearSignature()"
              class="text-red-600 hover:underline text-sm"
            >
              Remove
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Language Details Section -->
    <div class="space-y-4">
      <h6 class="text-sm font-medium text-blue-600 flex items-center gap-2">
        <svg
          class="h-5 w-5 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
          />
        </svg>
        Language Details
      </h6>

      <div
        formArrayName="languages"
        class="overflow-x-auto rounded-md ring-1 ring-gray-200"
      >
        <table class="min-w-full text-sm text-left">
          <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
            <tr>
              <th class="px-4 py-2 border border-gray-300 text-center w-12">
                S.No
              </th>
              <th class="px-4 py-2 border border-gray-300">
                Language Type<span class="text-red-500">*</span>
              </th>
              <th class="px-4 py-2 border border-gray-300">
                Language<span class="text-red-500">*</span>
              </th>
              <th class="px-4 py-2 border border-gray-300">
                Language Skill<span class="text-red-500">*</span>
              </th>
              <th class="px-4 py-2 border border-gray-300 text-center w-16">
                Action
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let lang of languagesArray.controls; let i = index"
              [formGroupName]="i"
              class="bg-white hover:bg-gray-50"
            >
              <td class="px-4 py-2 border border-gray-300 text-center">
                {{ i + 1 }}
              </td>
              <td class="px-4 py-2 border border-gray-300">
                <select
                  formControlName="m_rec_language_type_id"
                  [class.border-red-500]="
                    lang.get('m_rec_language_type_id')?.invalid &&
                    lang.get('m_rec_language_type_id')?.touched
                  "
                  class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
                >
                  <option value="">Select Type</option>
                  <option
                    *ngFor="let type of languageTypes"
                    [ngValue]="type.m_rec_language_type_id"
                  >
                    {{ type.language_type }}
                  </option>
                </select>
                <div
                  *ngIf="
                    lang.get('m_rec_language_type_id')?.invalid &&
                    lang.get('m_rec_language_type_id')?.touched
                  "
                  class="text-red-500 text-xs mt-1"
                >
                  Language type is required
                </div>
              </td>
              <td class="px-4 py-2 border border-gray-300">
                <select
                  formControlName="m_rec_language_id"
                  [class.border-red-500]="
                    lang.get('m_rec_language_id')?.invalid &&
                    lang.get('m_rec_language_id')?.touched
                  "
                  class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
                >
                  <option value="">Select Language</option>
                  <option *ngFor="let lang of languages" [ngValue]="lang.id">
                    {{ lang.language_name }}
                  </option>
                </select>
                <div
                  *ngIf="
                    lang.get('m_rec_language_id')?.invalid &&
                    lang.get('m_rec_language_id')?.touched
                  "
                  class="text-red-500 text-xs mt-1"
                >
                  Language is required
                </div>
              </td>
              <td class="px-4 py-2 border border-gray-300">
                <select
                  formControlName="m_rec_language_skill_id"
                  [class.border-red-500]="
                    lang.get('m_rec_language_skill_id')?.invalid &&
                    lang.get('m_rec_language_skill_id')?.touched
                  "
                  class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-600"
                >
                  <option value="">Select Skill</option>
                  <option
                    *ngFor="let skill of languageSkills"
                    [ngValue]="skill.m_rec_language_skill_id"
                  >
                    {{ skill.language_skill }}
                  </option>
                </select>
                <div
                  *ngIf="
                    lang.get('m_rec_language_skill_id')?.invalid &&
                    lang.get('m_rec_language_skill_id')?.touched
                  "
                  class="text-red-500 text-xs mt-1"
                >
                  Language skill is required
                </div>
              </td>
              <td class="px-4 py-2 border border-gray-300 text-center">
                <button
                  type="button"
                  (click)="removeLanguage(i)"
                  [disabled]="languagesArray.length === 1"
                  class="text-red-600 hover:text-red-800 text-sm font-semibold"
                >
                  ✖
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pt-2 text-right">
        <button
          type="button"
          (click)="addLanguage()"
          class="inline-block px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm font-medium"
        >
          + Add Language
        </button>
      </div>
    </div>
  </div>
</form>
