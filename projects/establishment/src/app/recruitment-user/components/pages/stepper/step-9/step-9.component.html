<div class="flex items-center justify-center">
  <div class="w-full bg-white border border-gray-400 overflow-hidden">
    <div
      *ngIf="formData[1]"
      class="bg-blue-200 px-6 py-4 border-b border-gray-200 text-center"
    >
      <h2 class="text-xl font-semibold tracking-wide text-blue-800">
        Application Form for {{ formData[1]["advertisment_name"] }}
      </h2>
    </div>

    <div class="p-4">
      <div
        *ngIf="formData[1]"
        class="flex flex-col md:flex-row md:items-start md:justify-between gap-6"
      >
        <!-- Left: Applicant Info -->
        <div class="flex-grow">
          <h3 class="text-2xl font-bold text-gray-900">
            {{ formData[1]["Salutation_E_Name"] }}
            {{ formData[1]["Applicant_First_Name_E"] }}
            {{ formData[1]["Applicant_Middle_Name_E"] }}
            {{ formData[1]["Applicant_Last_Name_E"] }}
          </h3>
          <div class="mt-2 space-y-1 text-base text-gray-700">
            <p>
              <span class="font-medium">Registration No:</span>
              {{ formData[1]["registration_no"] }}
            </p>
            <p>
              <span class="font-medium">Applied Post:</span>
              {{ formData[1]["post_name"] }}
            </p>
            <p>
              <span class="font-medium">Applied Subject:</span>
              {{ formData[1]["Subject_Name_E"] }}
            </p>
          </div>
        </div>

        <!-- Right: Photo + Signature -->
        <div class="flex-shrink-0 flex flex-col gap-3 items-center">
          <div *ngIf="formData[1]['candidate_photo']">
            <img
              [src]="getFileUrl(formData[1]['candidate_photo'])"
              alt="Applicant Photo"
              class="w-28 h-36 object-cover border border-gray-300 rounded"
            />
          </div>
          <div *ngIf="formData[1]['candidate_signature']">
            <img
              [src]="getFileUrl(formData[1]['candidate_signature'])"
              alt="Applicant Signature"
              class="w-40 h-16 object-contain border border-gray-300 p-1 bg-white rounded"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="p-8 space-y-10">
      <div *ngIf="formData[1]" class="p-6 border border-gray-400">
        <h4
          class="text-2xl font-bold text-blue-800 flex items-center gap-3 mb-6"
        >
          <svg
            class="h-7 w-7 text-blue-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
          Personal Information
        </h4>
        <div class="grid md:grid-cols-3 text-md border-t border-gray-300">
          <ng-container *ngFor="let item of getProcessedPersonalInfo()">
            <div>
              <p
                class="text-md font-semibold text-gray-500 uppercase tracking-widest mb-1"
              >
                {{ item.key }}
              </p>
              <p class="text-gray-900 font-medium break-words">
                {{ item.value }}
              </p>
            </div>
          </ng-container>
        </div>

        <div
          *ngIf="
            formData[1]['additionalInfoDetails'] &&
            formData[1]['additionalInfoDetails'].length > 0
          "
          class="mt-8"
        >
          <h6
            class="text-lg font-semibold text-blue-800 mb-3 flex items-center gap-3"
          >
            <svg
              class="h-6 w-6 text-blue-600"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12z"
              />
            </svg>
            Additional Information
          </h6>
          <div
            class="grid md:grid-cols-3 text-md pt-4 border-t border-gray-300"
          >
            <ng-container
              *ngFor="let item of formData[1]['additionalInfoDetails']"
            >
              <div>
                <p
                  class="text-md font-semibold text-gray-500 uppercase tracking-widest mb-1"
                >
                  {{ item.question }}
                </p>
                <ng-container
                  *ngIf="item.answer === 'File Uploaded'; else standardInfo"
                >
                  <span
                    class="inline-block bg-blue-100 text-blue-800 text-md font-semibold px-3 py-2 rounded-full"
                  >
                    ✓ File Uploaded
                  </span>
                </ng-container>
                <ng-template #standardInfo>
                  <p class="text-gray-900 font-medium break-words">
                    {{ formatValue(item.answer) }}
                  </p>
                </ng-template>
              </div>
            </ng-container>
          </div>
        </div>

        <div
          *ngIf="
            formData[1]['languages'] && formData[1]['languages'].length > 0
          "
          class="mt-8"
        >
          <h6
            class="text-lg font-semibold text-blue-800 mb-3 flex items-center gap-3"
          >
            <svg
              class="h-6 w-6 text-blue-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
              />
            </svg>
            Language Proficiency
          </h6>
          <div class="overflow-x-auto ring-1 ring-gray-200">
            <table class="min-w-full text-md border border-gray-300">
              <thead class="bg-blue-100 text-gray-700 uppercase text-base">
                <tr>
                  <th
                    class="px-4 py-2 border border-gray-300 font-semibold text-left"
                  >
                    Language
                  </th>
                  <th
                    class="px-4 py-2 border border-gray-300 font-semibold text-left"
                  >
                    Type
                  </th>
                  <th
                    class="px-4 py-2 border border-gray-300 font-semibold text-left"
                  >
                    Skill
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="let lang of formData[1]['languages']"
                  class="bg-white hover:bg-blue-50 transition-colors duration-200"
                >
                  <td class="px-4 py-2 border border-gray-300">
                    {{ lang.language_name }}
                  </td>
                  <td class="px-4 py-2 border border-gray-300">
                    {{ lang.language_type | titlecase }}
                  </td>
                  <td class="px-4 py-2 border border-gray-300">
                    {{ lang.language_skill }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <ng-container *ngFor="let i of [2, 3, 4, 5, 6]">
        <div *ngIf="formData[i]" class="bg-white p-6 border border-gray-200">
          <h4
            class="text-2xl font-bold text-blue-800 flex items-center gap-3 mb-6"
          >
            <ng-container [ngSwitch]="i">
              <svg
                *ngSwitchCase="2"
                class="h-7 w-7 text-blue-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                />
              </svg>
              <svg
                *ngSwitchCase="3"
                class="h-7 w-7 text-blue-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                />
              </svg>
              <svg
                *ngSwitchCase="4"
                class="h-7 w-7 text-blue-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
              <svg
                *ngSwitchCase="5"
                class="h-7 w-7 text-blue-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                />
              </svg>
              <svg
                *ngSwitchCase="6"
                class="h-7 w-7 text-blue-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
                />
              </svg>
            </ng-container>
            <span>{{
              (formData[i]["heading"] &&
                formData[i]["heading"]["score_field_title_name"]) ||
                steps[i - 1]
            }}</span>
          </h4>

          <div class="border-t border-gray-300 pt-4">
            <ng-container [ngSwitch]="i">
              <ng-container *ngSwitchCase="2">
                <div class="space-y-8">
                  <ng-container
                    *ngFor="let key of getFormDataKeys(formData[i])"
                  >
                    <div
                      *ngIf="
                        isExperienceKey(key) && formData[i][key]?.length > 0
                      "
                    >
                      <h6 class="font-semibold text-blue-800 mb-3 text-lg">
                        {{
                          formData[i]["subheadings"][key][
                            "score_field_title_name"
                          ]
                        }}
                      </h6>

                      <div class="overflow-x-auto ring-1 ring-gray-200">
                        <table
                          class="min-w-full text-md border border-gray-300"
                        >
                          <thead
                            class="bg-blue-700 text-white uppercase text-base"
                          >
                            <tr>
                              <th
                                *ngFor="
                                  let headerKey of getDisplayableKeys(
                                    formData[i][key][0]
                                  )
                                "
                                class="px-4 py-2 text-left font-semibold"
                              >
                                {{ formatKey(headerKey) }}
                              </th>
                            </tr>
                          </thead>

                          <tbody>
                            <tr
                              *ngFor="let item of formData[i][key]"
                              class="bg-white hover:bg-blue-50 transition-colors duration-200"
                            >
                              <td
                                *ngFor="let dataKey of getDisplayableKeys(item)"
                                class="px-4 py-2 border border-gray-300"
                              >
                                <span
                                  *ngIf="isFileValue(item[dataKey])"
                                  class="inline-block bg-blue-100 text-blue-800 text-base font-semibold px-3 py-1 rounded-full"
                                  >✓ File Uploaded</span
                                >
                                <ng-container
                                  *ngIf="!isFileValue(item[dataKey])"
                                >
                                  {{ formatValue(item[dataKey]) }}
                                </ng-container>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </ng-container>

              <ng-container *ngSwitchCase="5">
                <div class="space-y-8">
                  <ng-container
                    *ngFor="let key of getFormDataKeys(formData[i])"
                  >
                    <div
                      *ngIf="
                        isExperienceKey(key) && formData[i][key]?.length > 0
                      "
                    >
                      <h6 class="font-semibold text-blue-800 mb-3 text-lg">
                        {{
                          formData[i]["subheadings"][key][
                            "score_field_title_name"
                          ]
                        }}
                      </h6>
                      <div class="overflow-x-auto ring-1 ring-gray-200">
                        <div class="overflow-x-auto">
                          <table
                            class="min-w-full text-md border border-gray-300"
                          >
                            <thead
                              class="bg-blue-700 text-white uppercase text-md"
                            >
                              <tr>
                                <th
                                  *ngFor="
                                    let headerKey of getDisplayableKeys(
                                      formData[i][key][0]
                                    )
                                  "
                                  class="px-4 py-2 text-left font-semibold"
                                >
                                  {{ formatKey(headerKey) }}
                                </th>
                              </tr>
                            </thead>

                            <tbody>
                              <tr
                                *ngFor="let item of formData[i][key]"
                                class="bg-white hover:bg-blue-50 transition-colors duration-200"
                              >
                                <td
                                  *ngFor="
                                    let dataKey of getDisplayableKeys(item)
                                  "
                                  class="px-4 py-2 border border-gray-300"
                                >
                                  <ng-container
                                    *ngIf="
                                      dataKey
                                        .toLowerCase()
                                        .includes('attachment') ||
                                        dataKey
                                          .toLowerCase()
                                          .includes('document');
                                      else regularData
                                    "
                                  >
                                    <span
                                      *ngIf="
                                        checkFilesForSubheading(
                                          formData[i],
                                          key
                                        ) || isFileValue(item[dataKey])
                                      "
                                      class="inline-block bg-blue-100 text-blue-800 text-base font-semibold px-3 py-1 rounded-full"
                                    >
                                      ✓ File Uploaded
                                    </span>
                                    <span
                                      *ngIf="
                                        !checkFilesForSubheading(
                                          formData[i],
                                          key
                                        ) && !isFileValue(item[dataKey])
                                      "
                                      class="text-gray-400 italic"
                                    >
                                      —
                                    </span>
                                  </ng-container>

                                  <ng-template #regularData>
                                    {{ formatValue(item[dataKey]) }}
                                  </ng-template>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </ng-container>

              <ng-container *ngSwitchCase="3">
                <ng-container
                  [ngTemplateOutlet]="detailsTable"
                  [ngTemplateOutletContext]="{ stepIndex: i }"
                ></ng-container>
              </ng-container>
              <ng-container *ngSwitchCase="4">
                <ng-container
                  [ngTemplateOutlet]="detailsTable"
                  [ngTemplateOutletContext]="{ stepIndex: i }"
                ></ng-container>
              </ng-container>
              <ng-container *ngSwitchCase="6">
                <ng-container
                  [ngTemplateOutlet]="detailsTable"
                  [ngTemplateOutletContext]="{ stepIndex: i }"
                ></ng-container>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<ng-template #detailsTable let-stepIndex="stepIndex">
  <div class="space-y-8">
    <div
      *ngFor="
        let subheadKey of getFormDataKeys(formData[stepIndex]['subheadings'])
      "
    >
      <h6 class="font-semibold text-blue-800 mb-3 text-lg">
        {{
          formData[stepIndex]["subheadings"][subheadKey]["score_field_name_e"]
        }}
      </h6>
      <div class="overflow-x-auto ring-1 ring-gray-200">
        <table class="min-w-full text-md border border-gray-300">
          <ng-container
            *ngIf="
              hasDetailsForSubheading(stepIndex, subheadKey);
              else noDataTable
            "
          >
            <!-- Header -->
            <thead class="bg-blue-700 text-white uppercase text-md">
              <tr>
                <th
                  *ngFor="
                    let headerKey of getHeadersForSubheading(
                      stepIndex,
                      subheadKey
                    )
                  "
                  class="px-4 py-2 text-left font-semibold"
                >
                  {{ formatKey(headerKey) }}
                </th>
              </tr>
            </thead>

            <!-- Body -->
            <tbody>
              <ng-container
                *ngFor="let detail of formData[stepIndex]['details']"
              >
                <tr
                  *ngIf="
                    detailBelongsToSubheading(
                      detail,
                      formData[stepIndex]['subheadings'][subheadKey]['items']
                    )
                  "
                  class="bg-white hover:bg-blue-50 transition-colors duration-200"
                >
                  <td
                    *ngFor="let dataKey of getDisplayableKeys(detail)"
                    class="px-4 py-2 border border-gray-300"
                  >
                    <ng-container *ngIf="dataKey === 'type'; else standardCell">
                      {{ getDetailItemName(stepIndex, detail[dataKey]) }}
                    </ng-container>
                    <ng-template #standardCell>
                      <span
                        *ngIf="isFileValue(detail[dataKey])"
                        class="inline-block bg-blue-100 text-blue-800 text-base font-semibold px-3 py-1 rounded-full"
                        >✓ File Uploaded</span
                      >
                      <ng-container *ngIf="!isFileValue(detail[dataKey])">
                        {{ formatValue(detail[dataKey]) }}
                      </ng-container>
                    </ng-template>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </ng-container>

          <!-- No Data -->
          <ng-template #noDataTable>
            <thead class="bg-blue-700 text-white uppercase text-md">
              <tr>
                <th class="px-4 py-2 text-left font-semibold">Information</th>
              </tr>
            </thead>
            <tbody>
              <tr class="bg-white">
                <td
                  class="px-4 py-4 text-gray-500 italic border border-gray-300"
                >
                  — No data provided for this section.
                </td>
              </tr>
            </tbody>
          </ng-template>
        </table>
      </div>
    </div>
  </div>
</ng-template>
<form [formGroup]="form" (ngSubmit)="submit()">
  <div class="flex items-center justify-center">
    <div class="w-full bg-white border border-gray-100 overflow-hidden"></div>
  </div>

  <div class="p-8">
    <div class="border border-gray-400 rounded-md p-4 bg-white mb-8">
      <h4
        class="mb-3 text-blue-800 text-md font-semibold flex items-center gap-1.5"
      >
        <svg
          class="h-8 w-8 text-blue-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          />
        </svg>
        Declaration
      </h4>
      <div class="flex items-start gap-2">
        <input
          type="checkbox"
          class="accent-blue-600 w-4 h-4 mt-1"
          formControlName="declaration"
        />
        <label
          class="text-md text-gray-700"
          [innerHTML]="declarationText"
        ></label>
      </div>
      <div
        *ngIf="
          form.get('declaration')?.invalid && form.get('declaration')?.touched
        "
        class="text-red-600 text-md mt-2 ml-6"
      >
        You must accept the declaration to continue.
      </div>
    </div>

    <div class="text-center mt-5">
      <p class="text-md text-red-600 mt-1.5 font-medium italic tracking-tight">
        Note: This is not the final copy of the application. Please keep the
        final copy of your application after payment for future reference. You
        are not allowed to edit the application after Final Submit.
      </p>
    </div>
  </div>
</form>
