<div class="p-4 sm:p-6 bg-white">
  <!-- Stepper Header -->
  <div class="w-full flex justify-center py-4 border-b">
    <div class="w-full overflow-x-auto">
      <div
        class="mx-auto max-w-5xl flex items-center justify-center space-x-2 sm:space-x-4"
      >
        <ng-container *ngFor="let step of steps; let i = index">
          <div
            class="flex items-center"
            [class.cursor-pointer]="i < currentStep - 1 || completedSteps[i]"
            (click)="goToStep(i + 1)"
          >
            <div
              class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold transition-all duration-300"
              [ngClass]="{
                'bg-indigo-600 text-white': currentStep === i + 1,
                'bg-green-600 text-white': currentStep > i + 1,
                'bg-gray-200 text-gray-700': currentStep < i + 1
              }"
            >
              {{ i + 1 }}
            </div>
            <div class="ml-2 text-sm font-medium whitespace-nowrap">
              {{ step.score_field_name_e }}
            </div>
            <div
              *ngIf="i < steps.length - 1"
              class="h-0.5 w-6 sm:w-10 md:w-14 lg:w-20 ml-2 transition-colors duration-300"
              [ngClass]="{
                'bg-green-600': currentStep > i + 1,
                'bg-gray-200': currentStep <= i + 1
              }"
            ></div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Dynamic Step Content -->
  <div class="w-full mt-8 min-h-[300px]">
    <div *ngIf="!isLoading" @fadeSlide>
      <ng-container [ngSwitch]="steps[currentStep - 1].m_rec_score_field_id">
        <app-step-1
          *ngSwitchCase="0"
          (formData)="updateFormData(currentStep, $event)"
        ></app-step-1>
        <app-step-2
          *ngSwitchCase="1"
          (formData)="updateFormData(currentStep, $event)"
        ></app-step-2>
        <app-step-3
          *ngSwitchCase="8"
          (formData)="updateFormData(currentStep, $event)"
        ></app-step-3>
        <app-step-4
          *ngSwitchCase="18"
          (formData)="updateFormData(currentStep, $event)"
        ></app-step-4>
        <app-step-5
          *ngSwitchCase="32"
          (formData)="updateFormData(currentStep, $event)"
        ></app-step-5>
        <app-step-6
          *ngSwitchCase="34"
          (formData)="updateFormData(currentStep, $event)"
        ></app-step-6>
      </ng-container>
    </div>

    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="flex justify-center items-center h-48">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"
      ></div>
    </div>
  </div>

  <!-- Stepper Footer Buttons -->
  <div class="flex justify-between items-center mt-8 pt-4 border-t">
    <button
      (click)="prevStep()"
      [disabled]="currentStep === 1"
      class="px-5 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm font-medium rounded-md transition disabled:opacity-50 disabled:cursor-not-allowed"
    >
      Back
    </button>
    <button
      (click)="nextStep()"
      class="px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-md shadow-sm transition"
    >
      {{
        currentStep === steps.length && steps.length > 0
          ? "Submit Final Decision"
          : "Update & Continue"
      }}
    </button>
  </div>
</div>

<!-- ========================= -->
<!-- Final Decision Modal -->
<!-- ========================= -->
<div
  *ngIf="isFinalModalOpen"
  @fadeSlide
  class="fixed inset-0 z-50 flex items-center justify-center bg-white/40 backdrop-blur-sm rounded-md"
>
  <div class="bg-white shadow-xl w-full max-w-3xl overflow-hidden rounded-sm">
    <!-- Modal Header -->
    <div
      class="modal-header flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 sm:p-3 bg-blue-200 border-b"
    >
      <!-- Title & Subtitle -->
      <div>
        <h3 class="text-lg sm:text-xl font-semibold text-gray-900">
          Final Screening Decision
        </h3>
        <p class="text-sm text-gray-500 mt-1">
          Make your final decision for candidate eligibility
        </p>
      </div>

      
    </div>

    <!-- Modal Body -->
    <div class="max-h-[70vh] overflow-y-auto">
      <app-step-final-decision></app-step-final-decision>
    </div>

    <!-- Modal Footer -->
    <div
      class="flex flex-wrap items-center justify-end gap-3 p-4 bg-gray-50 border-t"
    >
      <button
        (click)="closeFinalModal()"
        class="px-5 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm font-medium rounded-md transition"
      >
        Cancel
      </button>
      <button
        (click)="submitFinalDecision()"
        class="px-5 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-md shadow-sm transition"
      >
        Submit Final Decision
      </button>
    </div>
  </div>
</div>
