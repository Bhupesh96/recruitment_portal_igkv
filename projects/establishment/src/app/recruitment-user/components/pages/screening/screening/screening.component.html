<div class="flex flex-col min-h-screen">
  <app-header></app-header>

  <main class="flex-grow">
    <!-- Dashboard Header -->
    <div
      class="relative bg-gradient-to-r from-blue-900 via-blue-800 to-blue-700 text-white shadow-md"
    >
      <div class="max-w-7xl mx-auto px-6 py-6 space-y-6">
        <div
          class="flex flex-col sm:flex-row sm:items-center sm:justify-between"
        >
          <div>
            <h1 class="text-2xl font-bold tracking-wide">
              Screening Dashboard
            </h1>
            <p class="text-sm text-blue-100 mt-1">
              Monitor candidate status and progress in real-time
            </p>
          </div>
          <div class="flex gap-2 mt-3 sm:mt-0">
            <button
              class="px-4 py-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-sm font-medium transition-all duration-200"
              (click)="refreshData()"
            >
              Refresh
            </button>
            <button
              class="px-4 py-2 bg-white text-blue-700 font-medium rounded-lg shadow hover:shadow-md hover:bg-blue-50 transition-all duration-200"
            >
              Export Report
            </button>
          </div>
        </div>

        <!-- Filter Section -->
        <div
          class="bg-white/80 backdrop-blur-md border border-gray-200 shadow-xl rounded-2xl p-5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5"
        >
          <!-- Advertisement -->
          <div class="flex flex-col">
            <label class="text-sm font-medium text-gray-700 mb-1"
              >Advertisement</label
            >
            <select
              [(ngModel)]="selected.advertisement"
              (ngModelChange)="onAdvertisementChange($event)"
              class="rounded-xl border-gray-300 bg-white/70 text-gray-800 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm p-2.5"
            >
              <option [ngValue]="null">Select Advertisement</option>
              <option *ngFor="let d of advertisements" [ngValue]="d.id">
                {{ d.name }}
              </option>
            </select>
          </div>

          <!-- Post -->
          <div class="flex flex-col">
            <label class="text-sm font-medium text-gray-700 mb-1">Post</label>
            <select
              [(ngModel)]="selected.post"
              (ngModelChange)="onPostChange($event)"
              class="rounded-xl border-gray-300 bg-white/70 text-gray-800 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm p-2.5"
            >
              <option [ngValue]="null">Select Post</option>
              <option *ngFor="let p of posts" [ngValue]="p.id">
                {{ p.name }}
              </option>
            </select>
          </div>

          <!-- Subject -->
          <div class="flex flex-col">
            <label class="text-sm font-medium text-gray-700 mb-1"
              >Subject</label
            >
            <select
              [(ngModel)]="selected.subject"
              class="rounded-xl border-gray-300 bg-white/70 text-gray-800 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm p-2.5"
            >
              <option [ngValue]="null">Select Subject</option>
              <option *ngFor="let s of subjects" [ngValue]="s.id">
                {{ s.name }}
              </option>
            </select>
          </div>

          <!-- Claim Type -->
          <div class="flex flex-col">
            <label class="text-sm font-medium text-gray-700 mb-1"
              >Claim Type</label
            >
            <select
              [(ngModel)]="selected.claimType"
              class="rounded-xl border-gray-300 bg-white/70 text-gray-800 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm p-2.5"
            >
              <option value="" selected>Select Claim Type</option>
              <option value="Y">Eligibility Before Claim</option>
              <option value="N">Eligibility After Claim</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Stats Section -->
      <div class="backdrop-blur-md bg-white/10 border-t border-white/10">
        <div
          class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-4 px-6 py-3 text-center text-sm"
        >
          <div class="p-2 cursor-not-allowed rounded-lg">
            <p class="text-blue-100 uppercase text-xs">Advertisement</p>
            <p class="text-lg font-semibold">
              {{
                selected.advertisement
                  ? getNameById(advertisements, selected.advertisement)
                  : "-"
              }}
            </p>
          </div>
          <div class="p-2 cursor-not-allowed rounded-lg">
            <p class="text-blue-100 uppercase text-xs">Post Name</p>
            <p class="text-lg font-semibold">
              {{ selected.post ? getNameById(posts, selected.post) : "-" }}
            </p>
          </div>
          <div class="p-2 cursor-not-allowed rounded-lg">
            <p class="text-blue-100 uppercase text-xs">Post Type</p>
            <p class="text-lg font-semibold">
              {{ getSelectedPostStatus() }}
            </p>
          </div>

          <!-- Status Cards -->
          <div
            (click)="filterByStatus('')"
            [ngClass]="{ 'bg-white/20': selected.status === '' }"
            class="transition-all p-2 cursor-not-allowed rounded-lg cursor-pointer hover:bg-white/20 overflow-hidden"
          >
            <p class="text-blue-100 uppercase text-xs">Total Candidates</p>
            <p class="text-lg font-semibold">{{ currentStats.total }}</p>
          </div>

          <div
            (click)="filterByStatus('Allotted')"
            [ngClass]="{
              'bg-white/20': selected.status === 'Allotted'
            }"
            class="transition-all p-2 cursor-not-allowed rounded-lg cursor-pointer hover:bg-white/20 overflow-hidden"
          >
            <p class="text-blue-100 uppercase text-xs">Allotted Applicant</p>
            <p class="text-lg font-semibold text-blue-300">
              {{ currentStats.allotted }}
            </p>
          </div>
          <div
            (click)="filterByStatus('Pending')"
            [ngClass]="{
              'bg-white/20': selected.status === 'Pending'
            }"
            class="transition-all p-2 cursor-not-allowed rounded-lg cursor-pointer hover:bg-white/20 overflow-hidden"
          >
            <p class="text-blue-100 uppercase text-xs">Eligible</p>
            <p class="text-lg font-semibold text-yellow-300">
              {{ currentStats.selected }}
            </p>
          </div>
          <div
            (click)="filterByStatus('Selected')"
            [ngClass]="{
              'bg-white/20': selected.status === 'Selected'
            }"
            class="transition-all p-2 cursor-not-allowed rounded-lg cursor-pointer hover:bg-white/20 overflow-hidden"
          >
            <p class="text-blue-100 uppercase text-xs">Not Eligible</p>
            <p class="text-lg font-semibold text-green-300">
              {{ currentStats.pending }}
            </p>
          </div>
          <div
            (click)="filterByStatus('Rejected')"
            [ngClass]="{
              'bg-white/20': selected.status === 'Rejected'
            }"
            class="transition-all p-2 cursor-not-allowed rounded-lg cursor-pointer hover:bg-white/20 overflow-hidden"
          >
            <p class="text-blue-100 uppercase text-xs">Pending</p>
            <p class="text-lg font-semibold text-red-300">
              {{ currentStats.pending }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Candidate Cards -->
    <div class="w-full px-10 md:px-12 lg:px-20 mt-3 space-y-5 pb-12">
      <div class="flex justify-center mb-4">
        <div class="relative w-full sm:w-64 md:w-72 lg:w-80">
          <input
            type="text"
            [(ngModel)]="searchText"
            placeholder="Search by name, reg no, post..."
            class="pl-9 pr-3 py-1.5 w-full text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition"
          />
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1010.5 18.5a7.5 7.5 0 006.15-3.85z"
            />
          </svg>
        </div>
      </div>

      <div
        *ngFor="let c of filteredCandidates; let i = index"
        class="bg-white rounded-2xl shadow-lg border border-gray-100 hover:border-blue-300 hover:shadow-blue-100 transition-all duration-300 overflow-hidden"
      >
        <div
          class="flex justify-between items-center p-5 cursor-pointer"
          (click)="toggleExpand(i)"
        >
          <div class="flex items-center gap-4">
            <!-- ✅ Numbering Badge: perfectly centered -->
            <div
              class="w-8 h-8 flex items-center justify-center bg-blue-100 text-blue-700 font-semibold rounded-full text-sm flex-shrink-0"
            >
              {{ i + 1 }}
            </div>

            <!-- Candidate Info -->
            <div class="flex-1">
              <p class="text-md mt-1">
                <span class="font-medium">Reg No:</span>
                {{ c.registrationNo }} • <span class="font-medium">Name:</span>
                {{ c.name }} • <span class="font-medium">Age:</span>
                {{ c.age }} • <span class="font-medium">Category:</span>
                {{ c.category }}
              </p>

              <p class="text-md text-gray-500 mt-1">
                <span class="text-blue-600 font-medium">{{
                  c.advertisement
                }}</span>
                • {{ c.post }}
              </p>
            </div>
          </div>

          <div
            class="w-9 h-9 flex items-center justify-center rounded-full bg-blue-50 text-blue-600 shadow-sm transform transition-transform duration-300"
            [ngClass]="{ 'rotate-180': expandedIndex === i }"
          >
            ▼
          </div>
        </div>

        <div
          *ngIf="expandedIndex === i"
          class="border-t transition-all duration-500"
        >
          <div
            *ngIf="viewingProfileIndex !== i"
            class="bg-gradient-to-r from-blue-50 to-purple-50 px-6 py-4"
          >
            <p class="text-gray-700 text-sm leading-relaxed mb-4">
              {{
                c.details || "Candidate details and summary will appear here."
              }}
            </p>
            <div class="flex gap-3">
              <button
                (click)="showProfile(c, i, $event)"
                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg shadow-md transition"
              >
                View Profile
              </button>
            </div>
          </div>

          <div *ngIf="viewingProfileIndex === i">
            <app-stepper (close)="closeProfile()"></app-stepper>
          </div>
        </div>
      </div>

      <!-- No Data -->
      <div
        *ngIf="filteredCandidates.length === 0"
        class="text-center py-16 bg-white rounded-2xl shadow-inner text-gray-500"
      >
        <p class="text-lg font-medium mb-2">No candidates found</p>
        <p class="text-sm opacity-70">Try adjusting your filters above.</p>
      </div>
    </div>
  </main>
  <app-footer></app-footer>
</div>
